<!doctype html>


  

<html class="theme-next pisces use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>八股之十-发现镓</title>
  
  <meta name="keywords" content="八股文,">

<meta name="description" content="并发编程的特性：可见性、有序性和原子性分别介绍一下？ 原子性  是指在一次或者多次操作时，要么所有操作都被执行，要么所有操作都不执行。">
<meta name="keywords" content="八股文">
<meta property="og:type" content="article">
<meta property="og:title" content="八股之十">
<meta property="og:url" content="http://www.fancyga.com/2023/07/14/八股之十/index.html">
<meta property="og:site_name" content="发现镓">
<meta property="og:description" content="并发编程的特性：可见性、有序性和原子性分别介绍一下？ 原子性  是指在一次或者多次操作时，要么所有操作都被执行，要么所有操作都不执行。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/358b09e1fb7c48359c3c0a0f84c4b156.jpeg">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/1ba8304a31794a45b29146e78c448275.jpeg">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/f365394073ad448aaeb46b55c8375a64.webp">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/03c08675c0274a6ca6bd40391188fc13.jpeg">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/0d6e5cf6f5f544459255b711b04edf7c.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/af6785b8c91f64775daa4f2d0631c0f9.png">
<meta property="og:updated_time" content="2023-07-14T01:45:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="八股之十">
<meta name="twitter:description" content="并发编程的特性：可见性、有序性和原子性分别介绍一下？ 原子性  是指在一次或者多次操作时，要么所有操作都被执行，要么所有操作都不执行。">
<meta name="twitter:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/358b09e1fb7c48359c3c0a0f84c4b156.jpeg">


  <link rel="canonical" href="http://www.fancyga.com/2023/07/14/八股之十/">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


  <meta name="baidu-site-verification" content="wAcdUCCSr1">



  
  
    
  
  <link href="/cdn/jquery.fancybox.min.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/cdn/pace-theme-minimal.css">
  <script src="/cdn/pace.min.js"></script>

  
  
  
  
  
    
    
  
  
  
  
  
  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  


<link href="/cdn/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <link rel="alternate" href="/atom.xml" title="发现镓" type="application/atom+xml">


  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png?v=5.1.0">


  <link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    },
    algolia: {
      applicationID: 'BCDXWW18MV',
      apiKey: '156dd69e5ea1334037799ce473064e07',
      indexName: 'fancyga',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索...","hits_empty":"未找到匹配结果: ${query}","hits_stats":"找到${hits} 条查询结果，用时 ${time} ms"}
    }
  };
</script>



</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?4b3f4eeb2a5ddee114ae31fe440b904b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





  
  
    
  
  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  
  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">发现镓</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">fancyga ≈ 发现镓</p>
</div>
<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>
<nav class="site-nav">
  
  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-top">
          <a href="/top" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-signal"></i> <br>
            
            热榜
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-one">
          <a href="/one" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br>
            
            一句
          </a>
        </li>
      
        
        <li class="menu-item menu-item-timeline">
          <a href="/timeline" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-road"></i> <br>
            
            时线
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  
  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>

 </div>
    </header>

    <div class="moon-menu">
  <div class="moon-menu-items">

      <div class="moon-menu-item" id="moon-menu-item-back2bottom">
        <i class="fa fa-chevron-down"></i>
      </div>

      <div class="moon-menu-item" id="moon-menu-item-back2top">
        <i class="fa fa-chevron-up"></i>
      </div>

  </div>

  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"/>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"/>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon">
        <i class="fa fa-ellipsis-v"></i>
      </div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div>
  <div class="reading-progress-bar"></div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                八股之十
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="创建于" itemprop="dateCreated" datetime="2023-07-14T09:45:00+08:00">
              2023-07-14
            </time>
            
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/八股文/" itemprop="url" rel="index">
                    <span itemprop="name">八股文</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          
          
             <span id="/2023/07/14/八股之十/" class="leancloud_visitors" data-flag-title="八股之十">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span id="busuanzi_value_page_pv"></span>
               <span class="leancloud-visitors-count"></span>
              </span>
          
          
          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>8.9k</span>
            </span>
          
          &nbsp; | &nbsp;
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>8 分钟</span>
            </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="并发编程的特性：可见性、有序性和原子性分别介绍一下？"><a href="#并发编程的特性：可见性、有序性和原子性分别介绍一下？" class="headerlink" title="并发编程的特性：可见性、有序性和原子性分别介绍一下？"></a>并发编程的特性：可见性、有序性和原子性分别介绍一下？</h3><blockquote>
<p>原子性</p>
</blockquote>
<p>是指在一次或者多次操作时，要么所有操作都被执行，要么所有操作都不执行。</p>
<a id="more"></a>
<p>注意：</p>
<ul>
<li>多个原子性的操作合在一起不一定是原子性的。比如：<code>i++</code>就不是原子性的。</li>
<li><code>volatile</code>不能保证原子性，<code>synchronized</code>关键字能保证。</li>
<li>Java当中具有原子性的变量有：<code>AtomicInteger</code>、<code>AtomicLong</code>。</li>
<li>Java中，为了保证原子性，提供了两个高级的字节码指令<code>monitorenter</code>和<code>monitorexit</code>。</li>
</ul>
<blockquote>
<p>可见性</p>
</blockquote>
<p>是指一个线程对共享变量的修改能够被其他线程立即看到的特性。</p>
<ul>
<li><code>volatile</code>可以保证可见性。</li>
<li><code>synchronized</code>也可以保证可见性。</li>
<li>使用<code>Lock</code>相关的工具类可保证可见性。</li>
</ul>
<p>对于<code>volatile</code>变量，当对其进行写操作的时候，JVM会向处理器发送一条lock前缀的指令，将这个缓存中的变量回写到系统主存中，而其他处理器的缓存由于遵守了缓存一致性协议，会把这个变量的值从主存加载到自己的缓存中， 这就保证了其值在多个缓存中是可见的。</p>
<p><code>synchronized</code>能够保证同一时刻只有一个线程获得锁，并确保在锁释放前，会把变量的修改刷到主存中。</p>
<blockquote>
<p>有序性</p>
</blockquote>
<p>所谓有序是针对<strong>指令重排</strong>来说的。</p>
<p>背景：在Java中，为了提高程序运行效率，可能在编译期和运行期会对代码指令进行一定的优化，不会保证代码执行顺序严格按照编写代码的顺序执行。</p>
<p>比如如下例子：</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Thread one</span></span><br><span class="line">A = b + c</span><br><span class="line">D = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Thread two</span></span><br><span class="line">if(D) &#123;</span><br><span class="line">    System.out.println(A);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：Thread one将A、D共享变量从主内存复制到当前CPU内核的多级缓存中，按顺序执行完<code>A = b + c</code>和<code>D = true</code>后，多级缓存中A = 2，D = true。然后 Thread one将D的值<code>优先同步</code>到主缓存，A的值没有同步到主缓存。此时Thread two执行，能看到D的最新值true，却不能看到A的最新值，只能看到主缓存中A的初始值0。</p>
<ul>
<li><code>volatile</code>可通过<strong>内存屏障</strong>（Java中的内存屏障是一种CPU指令，可以防止CPU对指令序列进行重排序）来禁止指令重排，保证有序性。</li>
<li><code>synchronized</code>可以保证同一时刻只允许一个线程操作，因而当然可以保证多线程之间操作的有序性。</li>
</ul>
<h3 id="内存模型、主内存、工作内存？"><a href="#内存模型、主内存、工作内存？" class="headerlink" title="内存模型、主内存、工作内存？"></a>内存模型、主内存、工作内存？</h3><p>Java的内存模型，即JMM（Java Memory Model），就是一种符合内存模型规范的，屏蔽了各种硬件和操作系统的访问差异的，保证了Java程序在各种平台下对内存的访问都能保证效果一致的机制及规范。</p>
<p>Java内存模型规定了所有的变量都存储在<strong>主内存</strong>中，每条线程还有自己的<strong>工作内存</strong><br>，线程的工作内存中保存了该线程中使用到的变量的主内存副本拷贝，线程对变量的所有操作必须在工作内存中进行，而不能直接读写主内存。线程间变量的传递均需要自己的工作内存和主存之间进行数据同步。</p>
<h3 id="可见性的问题为什么会出现？"><a href="#可见性的问题为什么会出现？" class="headerlink" title="可见性的问题为什么会出现？"></a>可见性的问题为什么会出现？</h3><p>可见性是说：一个线程对共享变量的修改，其他线程能够立马看到。</p>
<p>这个在单核时代不是问题，因为各线程用的都是同一个CPU缓存。但在多核时代这个问题出现了，因为多核用的是不同核下的CPU缓存，这涉及到了缓存一致性的问题。</p>
<h3 id="操作系统级别有没有可见性的问题？原子性问题是怎么发生的？为什么会被打断？"><a href="#操作系统级别有没有可见性的问题？原子性问题是怎么发生的？为什么会被打断？" class="headerlink" title="操作系统级别有没有可见性的问题？原子性问题是怎么发生的？为什么会被打断？"></a>操作系统级别有没有可见性的问题？原子性问题是怎么发生的？为什么会被打断？</h3><p>操作系统级别也有可见性问题，这是由于多核CPU的多级缓存引起的，缓存间的数据也会产生数据不一致的问题。原子性的问题发生是由于CPU时间片机制。</p>
<p>比如，一个线程在执行<code>读改写</code>操作，在执行完<code>读改</code>之后，因为CPU还要顾及到其他线程执行，有不同的调度机制，该线程就被打断，让出了CPU给其他线程执行，在这个情况下，完整的<code>读改写</code>就被分割了，不是一个原子操作。</p>
<h3 id="加锁的过程是怎么同时保证三个特性的？锁的时间片丢了怎么办，有影响吗？"><a href="#加锁的过程是怎么同时保证三个特性的？锁的时间片丢了怎么办，有影响吗？" class="headerlink" title="加锁的过程是怎么同时保证三个特性的？锁的时间片丢了怎么办，有影响吗？"></a>加锁的过程是怎么同时保证三个特性的？锁的时间片丢了怎么办，有影响吗？</h3><p>加锁可以保证原子性，因为同一时刻只有一个线程操作，其他线程都是被阻塞，直到锁释放。这样该线程内执行的语句就可以保证原子性了，不会被其他线程干扰。</p>
<p>当一个线程获取到锁并修改了共享变量的值后，其他线程获取锁之前会重新读取到该共享变量的最新值，从而可以保证可见性。</p>
<p>加锁可以保证只有一个线程执行，这样该线程内的操作，顺序与代码的顺序是一致的，从而保证有序性。</p>
<p>锁的时间片丢了怎么办？丢了不会影响到三个特性，因为其他线程都是阻塞状态。但是时间片丢失会影响并发性，因为其他线程可能需要等待更长时间才能获得锁。</p>
<p>因此在设计和使用锁的过程中，需要考虑锁的粒度、持有时间等要素，平衡线程的竞争和系统的响应性能。</p>
<p>一般来说，锁会有个升级的过程，应根据情况自动调整锁等级。下面的问题详细回答。</p>
<h3 id="synchronized会加内存屏障吗？synchronized锁的是什么？一定是对象吗？锁的是对象的什么东西呢？对-class加锁锁的是什么？"><a href="#synchronized会加内存屏障吗？synchronized锁的是什么？一定是对象吗？锁的是对象的什么东西呢？对-class加锁锁的是什么？" class="headerlink" title="synchronized会加内存屏障吗？synchronized锁的是什么？一定是对象吗？锁的是对象的什么东西呢？对.class加锁锁的是什么？"></a>synchronized会加内存屏障吗？synchronized锁的是什么？一定是对象吗？锁的是对象的什么东西呢？对.class加锁锁的是什么？</h3><p><code>synchronized</code>的有序性是依靠内存屏障实现的，在<code>monitorenter</code>指令和<code>Load</code>屏障之后，会加一个<code>Acquire</code>屏障，这个屏障的作用是禁止同步代码块里面的读操作和外面的读写操作之间发生指令重排。</p>
<p><code>synchronized</code>锁有分<code>对象锁</code>和<code>类锁</code>，对.class加锁锁的是类，就是属于<code>类锁</code>。</p>
<p>对象锁有如下：</p>
<ol>
<li>锁住实体里的非静态变量</li>
<li>锁住<code>this</code>对象</li>
<li>直接锁非静态方法</li>
</ol>
<p>类锁有如下：</p>
<ol>
<li>锁类中的静态变量</li>
<li>锁住<code>.class</code></li>
<li>直接锁静态方法</li>
</ol>
<p>由于类对象也就是<code>Class</code>对象也是一个对象，所以说<code>synchronized</code>锁的一定是对象。</p>
<p>那锁的是对象的什么东西呢？</p>
<p>既然是对对象加锁，我们来看下对象的结构。<code>HotSpot</code>虚拟机中，对象在内存中存储的布局可以分为三块区域：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。其中锁的信息都是存在对象头的<code>Mark Word</code>中的。结构如下：</p>
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/358b09e1fb7c48359c3c0a0f84c4b156.jpeg" class="full-image">
<p>在JDK1.6以及之前的版本中，<code>synchronized</code>锁是通过对象内部的一个叫<code>监视器锁</code>（也称对象锁）来实现的，这种锁是<strong>重量级锁</strong>，因为获取锁和释放锁都需要在操作系统层面上进行线程的阻塞和唤醒，这些操作会带来很大开销。</p>
<p>在JDK1.6之后，<code>synchronized</code>锁的实现发生了一些变化，引入了<strong>偏向锁</strong>、<strong>轻量级锁</strong>和<strong>重量级锁</strong>三种不同状态，来适应不同场景下的锁竞争情况。</p>
<p>所以，在Java中，锁的状态分为四种，分别是无锁状态、偏向锁状态、轻量级锁状态和重量级锁状态。在Java中，<code>Mark Word</code>的低两位用于表示锁的状态，由于无锁状态和偏向锁都是01，所以在低三位引入偏向锁标记位.用”0”表示无锁，”1”表示偏向锁。</p>
<p><code>synchronized</code>锁有个升级的过程：</p>
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/1ba8304a31794a45b29146e78c448275.jpeg" class="full-image">
<p>各个锁的优缺点比较图：</p>
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/f365394073ad448aaeb46b55c8375a64.webp" class="full-image">
<blockquote>
<p>无锁</p>
</blockquote>
<p>初始状态下，对象处于无锁状态，多个线程可并发执行。</p>
<blockquote>
<p>偏向锁</p>
</blockquote>
<p>当一个线程来访问一个对象的同步块时，JVM会在对象头中设置该线程的标识，并将对象头的状态位设置为<code>偏向锁</code>。</p>
<p>这个过程称为<code>偏向</code>，表示偏向第一个访问它的线程。</p>
<p>这个锁实际上并没有真正的加锁，因为这时候只有一个线程，没必要加一把大锁，它只是将自己的线程标识贴在<code>Mark Word</code>上，做个标记，为后续准备。</p>
<blockquote>
<p>轻量级锁</p>
</blockquote>
<p>当有其他线程来访时，会检查该对象的偏向锁标识，如果和自己的线程标识相同，则直接获取锁，如果不同则该对象的锁状态就会升级到轻量级锁状态。</p>
<p>轻量级锁使用CAS（所以又叫自旋锁）操作来进行加锁和解锁，避免了线程阻塞和唤醒的开销。</p>
<blockquote>
<p>重量级锁</p>
</blockquote>
<p>轻量级锁自旋如果成功了，则表示获取到了锁，可继续执行，如果失败了，表示存在竞争，则需要膨胀为重量级锁。</p>
<p>此时，如果一个线程想要获取改对象的锁，需要先进入等待队列，等待该锁被释放。当锁释放时，JVM会从等待队列中选择一个线程唤醒。</p>
<p>重量级锁使用操作系统的互斥量（Mutex）来实现线程的阻塞和唤醒。当线程无法获取重量级锁时，会进入阻塞状态，直到锁被释放或者唤醒。</p>
<blockquote>
<p>锁的升级过程是由JVM自动管理的，开发者无需手动介入。JVM会根据具体的执行情况和竞争情况来选择适当的锁级别，以提供最佳的性能和线程安全性。</p>
</blockquote>
<blockquote>
<p>轻量级锁什么时候升级重量级锁？</p>
</blockquote>
<p>JDK1.6之前，有线程CAS转圈超过10卷或者多个线程在等待(超过cpu/2个线程)会升级，参数可配置。JDK1.6之后，自适应，jvm内部会调整。</p>
<blockquote>
<p>有了轻量级锁为什么还要重量级锁？</p>
</blockquote>
<p>轻量级锁是利用自旋CAS实现，如果大量线程CAS也比较耗CPU，这是就要用到重量级锁，没锁就等着就行。</p>
<blockquote>
<p>什么情况下不用经过偏向锁直接升级到轻量级锁？</p>
</blockquote>
<p>偏向锁默认启动，上锁一般是在对象创建之后4秒之后加上，为什么是4秒？因为留4秒是给JVM启动会进行相关数据加载、协调进程同步的资源等。如果发现这个对象将会被多个线程进行访问，则没有必要上偏向锁了，直接上轻量级锁。</p>
<h3 id="CyclicBarrier和CountdownLatch区别？Java中还有哪些类基于CAS实现的？"><a href="#CyclicBarrier和CountdownLatch区别？Java中还有哪些类基于CAS实现的？" class="headerlink" title="CyclicBarrier和CountdownLatch区别？Java中还有哪些类基于CAS实现的？"></a>CyclicBarrier和CountdownLatch区别？Java中还有哪些类基于CAS实现的？</h3><p><code>CyclicBarrier</code>类似一个屏障，到达后等待着，等其他都到达一个同步点后再一起继续运行。<code>CountDownLatch</code>类似于倒计时，等待若干个线程执行完之后，再继续执行。</p>
<p>JDK提供了一系列基于CAS（Compare-And-Swap）实现的原子类，底层是<code>lock cmpxchfg</code>指令，可以保证比较交换的原子性，所以这些原子类都是线程安全的，而且是无锁并发，线程不会频繁切换，所以在某些场景下性能是优于加锁。</p>
<p>主要有以下类型：</p>
<ol>
<li>基础类型原子类，如<code>AtomicBoolean</code>、<code>AtomicInteger</code>、<code>AtomicLong</code></li>
<li>原子引用类，如<code>AtomicReference</code>，由于可能出现<code>ABA</code>问题（一个线程将A改为B，之后又改回A，这是后另外一个线程没法感知第一个线程的变化，仍然认为A不变，可以执行交换），所以出现了带版本的<code>AtomicStampedReference</code>，又由于有时候并不关心共享变量改了几次，而只是标记下是否发生过改变，加个标记即可，因而会有<code>AtomicMarkableReference</code>。</li>
<li>原子更新器，如<code>AtomicReferenceFieldUpdater</code>、<code>AtomicIntegerFieldUpdater</code>、<code>AtomicLongFieldUpdater</code>。注：原子字段更新器只能更新<code>volatile</code>字段，他可以保证可见性，但无法保证原子性。</li>
<li>原子数组类，如<code>AtomicIntegerArray</code>等。</li>
<li>原子累加器，如<code>LongAdder</code>等。</li>
</ol>
<h3 id="Atomic是什么场景下使用？和LongAdder区别？为什么不精确还要用呢？"><a href="#Atomic是什么场景下使用？和LongAdder区别？为什么不精确还要用呢？" class="headerlink" title="Atomic是什么场景下使用？和LongAdder区别？为什么不精确还要用呢？"></a>Atomic是什么场景下使用？和LongAdder区别？为什么不精确还要用呢？</h3><p><code>Atomic</code>适用于多线程高并发下对单个变量进行原子操作的场景。例如计数器、标记位等。它通过使用底层的CAS操作，避免使用锁带来的性能开销，提供了更高效的并发操作。</p>
<p><code>LongAdder</code>是Java 8引入的原子累加器，性能比<code>AtomicLong</code>好，因为提供了多个累加单元，最后才将结果汇总，这样多线程在累加时操作不同的单元，减少了CAS重试失败操作，提高性能。</p>
<p>正式由于使用了多个累加单元的分段累加策略，减少CAS，所以可能会出现计数不准确的情况，但在大多数情况下，这种误差可以接受。为什么还用它，当然是因为它较高效些，要进行性能和精确的权衡。</p>
<h3 id="RPC和HTTP的区别？为什么RPC会比HTTP效率高？"><a href="#RPC和HTTP的区别？为什么RPC会比HTTP效率高？" class="headerlink" title="RPC和HTTP的区别？为什么RPC会比HTTP效率高？"></a>RPC和HTTP的区别？为什么RPC会比HTTP效率高？</h3><p>RPC（Remote Procedure Call）和HTTP（Hypertext Transfer Protocol）是两种不同的通信协议，它们在设计和用途上有一些区别。</p>
<ol>
<li><p>功能和用途：</p>
<ul>
<li>RPC：RPC是一种用于实现远程过程调用的协议，它允许程序在不同的计算机或进程之间进行通信和调用。RPC可以用于构建分布式系统，实现不同节点之间的方法调用和数据交换。</li>
<li>HTTP：HTTP是一种用于传输超文本的协议，它主要用于在客户端和服务器之间传递请求和响应。HTTP通常用于构建基于Web的应用程序，通过请求和响应的方式获取和传输数据。</li>
</ul>
</li>
<li><p>通信方式：</p>
<ul>
<li>RPC：RPC通信是面向方法调用的，客户端可以直接调用远程服务端的方法，并获取返回结果。通信过程通常使用二进制协议，数据传输更加高效。</li>
<li>HTTP：HTTP通信是面向请求和响应的，客户端发送请求到服务器，并等待服务器返回响应。通信过程基于文本，包含请求头、请求体、响应头和响应体，相对于RPC的通信量较大。</li>
</ul>
</li>
<li><p><strong>序列化和反序列化</strong>：</p>
<ul>
<li>RPC：RPC通信中，数据的序列化和反序列化通常使用高效的二进制序列化方式，如Protocol Buffers、Thrift等，可以实现更快的数据传输和解析。</li>
<li>HTTP：HTTP通信中，数据的序列化和反序列化通常使用文本格式，如JSON、XML等，相对于二进制序列化会有一定的性能开销。</li>
</ul>
</li>
</ol>
<p>为什么RPC会比HTTP效率高呢？主要有以下几个方面的原因：</p>
<ul>
<li>二进制协议：RPC通信使用高效的<strong>二进制协议</strong>，减少了数据的序列化和反序列化的开销，同时它传的都是干货，减少了请求和响应的数据量和处理的开销。</li>
<li>连接的复用：RPC服务是基于TCP/IP协议的长连接，而HTTP服务大都是短连接，虽然HTTP1.1开始支持长连接，但也需要看服务端是否支持长连接，不太可控。</li>
</ul>
<p>需要注意的是，RPC和HTTP并不是完全互斥的，它们在不同的场景和需求下有各自的优势和适用性。RPC更适用于构建高性能、低延迟的分布式系统，而HTTP更适用于构建面向Web的应用程序，并提供了更广泛的兼容性和互操作性。</p>
<h3 id="JVM类加载机制？"><a href="#JVM类加载机制？" class="headerlink" title="JVM类加载机制？"></a>JVM类加载机制？</h3><blockquote>
<p>概述</p>
</blockquote>
<p>首先，在代码编译后，就会生成JVM能够识别的二进制字节流文件（*.class）。</p>
<p>接着Class文件从加载到JVM内存到卸载，经历了如下阶段：</p>
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/03c08675c0274a6ca6bd40391188fc13.jpeg" class="full-image">
<p>其中类加载机制指的是前面五个阶段，即包括加载、连接和初始化，其中连接包括验证、准备和解析，各个过程如下描述：</p>
<blockquote>
<p>加载</p>
</blockquote>
<p>查找并加载类的二进制数据（网络，jar包，运行时生成等），将类的.class文件中的二进制数据放入内存中，将其放在方法区中，然后在内存中创建一个<code>java.lang.Class</code>对象（方法区）。</p>
<blockquote>
<p>连接</p>
</blockquote>
<ol>
<li>验证：确保被加载的类的正确性（确保Class文件的字节流符合虚拟机的要求）。</li>
<li>准备：为类的静态变量分配内存并设置初始化值（通常为数据类型的零值，注意不是用户指定值）。另外，静态常量（<code>final static</code>修饰的），会在这个阶段初始化为用户指定值。</li>
<li>解析：主要将类、接口、字段和方法的符号引用转换为直接引用。（符号引用是一组符号来描述所引用的目标，而直接引用是指向目标的指针、偏移量或其他表示形式，与具体的内存地址相关。）</li>
</ol>
<blockquote>
<p>初始化</p>
</blockquote>
<p>这个阶段主要是执行了编译器整合的一个方法<code>cinit</code>，其里面进行了两个操作：1. 初始化静态变量（前面的连接时候并没有给静态变量设置用户指定值，这时指定）；2. 静态块执行。</p>
<ul>
<li><code>cinit</code>不一定生成，如果没有静态代码块或静态变量，那么编译器不会生成这个方法。</li>
<li>虚拟机会保证父类的<code>cinit</code>方法先执行，不需要像<code>init</code>方法一样显示地调用父类构造器来保证父类init方法执行完成。</li>
<li>这里用了一种懒加载的思想，所有Java虚拟机要这样实现：必须在每个类或接口被Java程序首次主动使用才初始化。</li>
</ul>
<blockquote>
<p>初始化时机</p>
</blockquote>
<ul>
<li>当遇到<code>new</code>、<code>getstatic</code>、<code>putstatic</code>或<code>invokestatic</code>这4条字节码指令时，比如<code>new</code>一个类，读取个静态字段(未被<code>final</code>修饰)或调用一个类的静态方法时。</li>
<li>使用java.lang.reflect包的方法对类进行反射调用时，如果类没初始化，需要触发其初始化。</li>
<li>初始化一个类，如果其父类还未初始化，则先触发该父类的初始化。</li>
<li>JVM启动时标明的启动类。</li>
</ul>
<p>每个Java类都有一个对应的类加载器，Java默认的类加载机制是双亲委派机制。</p>
<blockquote>
<p>类加载器</p>
</blockquote>
<ol>
<li>启动类加载器</li>
</ol>
<p>启动类加载器是C++实现的，JVM中最顶级的类加载器，主要加载Java平台的核心库（JAVA_HOME/jre/lib/rt.jar）中的类，如java.lang.Object和java.lang.String等。</p>
<ol start="2">
<li>扩展类加载器</li>
</ol>
<p>由<code>sun.misc.Launcher$ExtClassLoader</code>实现，主要加载扩展类（JAVA_HOME/jre/lib/ext/<em>.jar），或java.ext.dirs指定的路径中的所有类库（如javax.</em>开头的类），其父类加载器是启动类加载器。</p>
<ol start="3">
<li>应用程序类加载器</li>
</ol>
<p>由<code>sun.misc.Launcher$AppClassLoader</code>实现，负责加载应用程序类路径（classpath）下的类。，其父类加载器是扩展类加载器。（注意父子关系是组合关系，而非继承关系）</p>
<ol start="4">
<li>自定义加载器</li>
</ol>
<p>通过继承java.lang.ClassLoader实现自定义加载器。</p>
<p>类加载大致流程如下：</p>
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/0d6e5cf6f5f544459255b711b04edf7c.png" class="full-image">
<p>这就是所谓的<code>双亲委派模型</code>（Parents Delegation Mode），即除最顶层的启动类加载器，其余的类加载器都应由自己的父类加载器尝试先加载，加载不到后再从自身加载。</p>
<p>这样的模型有两个好处：</p>
<ul>
<li>确保Java核心类库都不会被篡改，比如用户如果编写java.lang.Object，不能让其覆盖系统的。</li>
<li>防止内存中存在多份同样的字节码。</li>
</ul>
<p>双亲委派模型主要由<code>ClassLoader#loadClass</code>实现，其是线程安全的，因为里面用了<code>synchronized</code>加锁，要想破坏这个模型，只需要自定义类加载器并重写<code>loadClass</code>方法，做些处理即可。</p>
<h3 id="有哪些破坏双亲委派的例子？Tomcat为啥要破坏双亲委派？为什么打破双亲委派就能实现隔离？如果公用的类怎么办？"><a href="#有哪些破坏双亲委派的例子？Tomcat为啥要破坏双亲委派？为什么打破双亲委派就能实现隔离？如果公用的类怎么办？" class="headerlink" title="有哪些破坏双亲委派的例子？Tomcat为啥要破坏双亲委派？为什么打破双亲委派就能实现隔离？如果公用的类怎么办？"></a>有哪些破坏双亲委派的例子？Tomcat为啥要破坏双亲委派？为什么打破双亲委派就能实现隔离？如果公用的类怎么办？</h3><blockquote>
<p>破坏双亲委派的例子</p>
</blockquote>
<ol>
<li>SPI</li>
</ol>
<p>SPI（Service Provider Interface），其核心思想是：依赖倒置，将具体的实现给外部实现。SPI的接口是Java核心库的一部分，由启动类加载；而实现类是由系统类加载器来完成加载。</p>
<p>启动类加载器是无法找到SPI的实现类的（因为它只加载Java核心库），按照双亲委派模型无法解决这个问题，唯一的办法就是破坏它。</p>
<p>比如JNDI、JDBC等SPI就是这样的例子。怎么破坏呢？</p>
<p>Java设计团队引入了一个不太优雅的设计：线程上下文类加载器（Thread Context ClassLoader）。这个类加载器可以通过java.lang.Thread的<code>setContextClassLoader</code>方法进行设置。如果没设置，就是默认的应用程序类加载器。</p>
<p>有了这个机制，就可以处理这个问题了。这实际上违背了双亲委派模型，但解决了这个SPI问题。</p>
<p>比如JDBC的驱动加载<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</code>就是利用了这种机制：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) &#123;</span><br><span class="line">    <span class="comment">// 用的Thread Context ClassLoader</span></span><br><span class="line">    ClassLoader cl = <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>.get<span class="constructor">ContextClassLoader()</span>;</span><br><span class="line">    return <span class="module-access"><span class="module"><span class="identifier">ServiceLoader</span>.</span></span>load(service, cl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>模块化</li>
</ol>
<p>模块化，是为了实现热插拔，热部署，用到这个特性：只需要将模块连同类加载器一起换掉，就可以实现代码的热替换。（一个类要想被卸载，必须要其相应<code>ClassLoader</code>实例卸载）</p>
<p>比如JDK9，已经支持了模块化机制，不会直接委派给父类加载器加载，而是按照模块的维度来划分类加载器，只有模块中找不到该类，才会采用双亲委派机制。</p>
<ol start="3">
<li>TOMCAT</li>
</ol>
<p>我们先来看TOMCAT作为一个WEB容器，需要支持的特性：</p>
<ul>
<li>可能需要部署多个应用程序，不同的应用程序可能会依赖同一个第三方类库的不同版本，不能要求同一个类库在同一个容器只有一份，因此需要保证每个应用程序都是独立的，相互隔离的。</li>
<li>部署在同一个容器中相同类库的相同版本可以共享，否则，多份相同的类库加载进虚拟机，浪费。</li>
<li>容器有自己依赖的库，不能与应用程序的类库混淆，两者隔离开来。</li>
<li>容器要支持不需要重启的JSP的修改，所谓<strong>热替换</strong>。</li>
</ul>
<p>然后我们看看双亲委派模型能不能支持以上特性。显然不行。</p>
<ul>
<li>第一点，双亲委派机制是无法加载两个相同类库的不同版本的，它只在乎你的全限定类名，只有一份。</li>
<li>第二点可以满足，因为默认机制就是保证唯一性。</li>
<li>第三点和第一点一样的问题。</li>
<li>第四点，其实就是需要改造成类似上面的模块化的方案。</li>
</ul>
<p>第四点解决就是，我们卸载JSP时，和其类加载器一同卸载，这样达到重新加载JSP的目的。</p>
<p>Tomcat是怎么设计类加载机制的呢？可看下图：</p>
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/af6785b8c91f64775daa4f2d0631c0f9.png" class="full-image">
<p>可以看到，前面3个类加载器和默认的是一样的。</p>
<ul>
<li>CommonClassLoader，加载/common/*</li>
<li>CatalinaClassLoader，加载/server/*</li>
<li>SharedClassLoader，加载/shared/*</li>
</ul>
<blockquote>
<p>以上三个加载器在tomcat6后合并到根目录下的lib目录下，即<tomcat>/lib/*.jar</tomcat></p>
</blockquote>
<ul>
<li>WebappClassLoader，通常有多个，每个WEB应用程序对应一个，加载<webapp>/WEB-INF/classes和<webapp>/WEB-INF/lib/*.jar</webapp></webapp></li>
<li>JasperLoader，每一个JSP文件对应一个JSP类加载器。</li>
</ul>
<p>可以看出，CommonClassLoader能加载的类都可以被CatalinaClassLoader和SharedClassLoader使用，从而实现了公有类库的共用，而CatalinaClassLoader和SharedClassLoader自己能加载的类则与对方相互隔离。</p>
<p>WebAppClassLoader可以使用SharedClassLoader加载到的类，但各个应用WebAppClassLoader实例之间相互隔离。</p>
<p>JasperLoader的加载范围仅仅是这个JSP文件所编译出来的那一个.Class文件，当容器检测到JSP文件被修改时，会替换掉目前的JasperLoader的实例，并通过再建立一个新的JasperLoader来实现JSP文件的热替换功能。</p>
<h3 id="加载后的类会立即初始化吗？内存的开辟是怎么做的？开辟多大的内存呢？内存分配过程会有线程安全问题吗？"><a href="#加载后的类会立即初始化吗？内存的开辟是怎么做的？开辟多大的内存呢？内存分配过程会有线程安全问题吗？" class="headerlink" title="加载后的类会立即初始化吗？内存的开辟是怎么做的？开辟多大的内存呢？内存分配过程会有线程安全问题吗？"></a>加载后的类会立即初始化吗？内存的开辟是怎么做的？开辟多大的内存呢？内存分配过程会有线程安全问题吗？</h3><h3 id="JVM本地方法区里面都有什么？常量存在哪？字符串常量池？字符串中的常量什么时候进入常量池的？运行时常量池和字符串池是一回事吗？"><a href="#JVM本地方法区里面都有什么？常量存在哪？字符串常量池？字符串中的常量什么时候进入常量池的？运行时常量池和字符串池是一回事吗？" class="headerlink" title="JVM本地方法区里面都有什么？常量存在哪？字符串常量池？字符串中的常量什么时候进入常量池的？运行时常量池和字符串池是一回事吗？"></a>JVM本地方法区里面都有什么？常量存在哪？字符串常量池？字符串中的常量什么时候进入常量池的？运行时常量池和字符串池是一回事吗？</h3>
      
    </div>
      
  <div class="popular-posts-header">推荐文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2023/07/14/八股之九/" rel="bookmark">八股之九</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2023/07/13/八股之八/" rel="bookmark">八股之八</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2023/07/12/八股之七/" rel="bookmark">八股之七</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2023/07/06/八股之一/" rel="bookmark">八股之一</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2023/07/08/八股之三/" rel="bookmark">八股之三</a></div>
      
    </li>
  
  </ul>

    

    <div>
      
        
  <div id="end-share">
        <div id="eof" class="print-invisible">
            <hr class="eof">
            <div class="word">发现镓</div>
        </div>
        <style type="text/css">
           .word {
              position: relative;
              text-align: center;
              top: -25px;
              width: 100%;
           }
            hr.eof {
              text-align: center;
              border: 0;
              height: 1px;
              background-image: -webkit-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
              background-image: -moz-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
              background-image: -ms-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
              background-image: -o-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
              margin: 40px 0px 10px 0;
            }
            hr.eof:after {
              content: '_';
              display: inline-block;
              position: relative;
              top: -13px;
              padding: 0 25px;
              background: #fff;
              color: #8c8b8b;
            }
        </style>
        <div align="center">
            <p><a href="http://www.fancyga.com/2023/07/14/八股之十/">本文章</a>由<a href="http://www.fancyga.com">发现镓</a>制作，转载请注明出处</p>
        </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/八股文/" rel="tag"><i class="menu-item-icon fa fa-tags fa-fw"></i> 八股文</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2023/07/14/每日札记-202300714-工作中如何调节心态/" rel="next" title="每日札记-202300714-工作中如何调节心态">
                <i class="fa fa-chevron-left"></i> 每日札记-202300714-工作中如何调节...
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2023/07/14/八股之九/" rel="prev" title="八股之九">
                八股之九 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="waline"></div>
      <script type="module">
        import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

        init({
          el: '#waline',
          lang: 'zh-CN',
          serverURL: 'https://waline.fancyga.com',
        });
      </script>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/default_avatar.jpg" alt="发现镓">
          <p class="site-author-name" itemprop="name">发现镓</p>
          <p class="site-description motion-element" itemprop="description">fancyga ≈ 发现镓</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">288</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">96</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">311</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/AfirSraftGarrier" target="_blank" title="GitHub" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1940794292" target="_blank" title="Weibo" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/afirsraftgarrier-29" target="_blank" title="ZhiHu" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  ZhiHu
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://blog.csdn.net/AfirSraftGarrier" target="_blank" title="CSDN" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank" rel="external nofollow">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        <script type="text/javascript" id="clstr_globe" src="//clustrmaps.com/globe.js?d=KfzQR1RfxJNVFk79QPaTuMGLxLPPyhkzlbySVmQ8LjE"></script>

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#并发编程的特性：可见性、有序性和原子性分别介绍一下？"><span class="nav-number">1.</span> <span class="nav-text">并发编程的特性：可见性、有序性和原子性分别介绍一下？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内存模型、主内存、工作内存？"><span class="nav-number">2.</span> <span class="nav-text">内存模型、主内存、工作内存？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可见性的问题为什么会出现？"><span class="nav-number">3.</span> <span class="nav-text">可见性的问题为什么会出现？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#操作系统级别有没有可见性的问题？原子性问题是怎么发生的？为什么会被打断？"><span class="nav-number">4.</span> <span class="nav-text">操作系统级别有没有可见性的问题？原子性问题是怎么发生的？为什么会被打断？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加锁的过程是怎么同时保证三个特性的？锁的时间片丢了怎么办，有影响吗？"><span class="nav-number">5.</span> <span class="nav-text">加锁的过程是怎么同时保证三个特性的？锁的时间片丢了怎么办，有影响吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized会加内存屏障吗？synchronized锁的是什么？一定是对象吗？锁的是对象的什么东西呢？对-class加锁锁的是什么？"><span class="nav-number">6.</span> <span class="nav-text">synchronized会加内存屏障吗？synchronized锁的是什么？一定是对象吗？锁的是对象的什么东西呢？对.class加锁锁的是什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CyclicBarrier和CountdownLatch区别？Java中还有哪些类基于CAS实现的？"><span class="nav-number">7.</span> <span class="nav-text">CyclicBarrier和CountdownLatch区别？Java中还有哪些类基于CAS实现的？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atomic是什么场景下使用？和LongAdder区别？为什么不精确还要用呢？"><span class="nav-number">8.</span> <span class="nav-text">Atomic是什么场景下使用？和LongAdder区别？为什么不精确还要用呢？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RPC和HTTP的区别？为什么RPC会比HTTP效率高？"><span class="nav-number">9.</span> <span class="nav-text">RPC和HTTP的区别？为什么RPC会比HTTP效率高？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JVM类加载机制？"><span class="nav-number">10.</span> <span class="nav-text">JVM类加载机制？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有哪些破坏双亲委派的例子？Tomcat为啥要破坏双亲委派？为什么打破双亲委派就能实现隔离？如果公用的类怎么办？"><span class="nav-number">11.</span> <span class="nav-text">有哪些破坏双亲委派的例子？Tomcat为啥要破坏双亲委派？为什么打破双亲委派就能实现隔离？如果公用的类怎么办？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加载后的类会立即初始化吗？内存的开辟是怎么做的？开辟多大的内存呢？内存分配过程会有线程安全问题吗？"><span class="nav-number">12.</span> <span class="nav-text">加载后的类会立即初始化吗？内存的开辟是怎么做的？开辟多大的内存呢？内存分配过程会有线程安全问题吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JVM本地方法区里面都有什么？常量存在哪？字符串常量池？字符串中的常量什么时候进入常量池的？运行时常量池和字符串池是一回事吗？"><span class="nav-number">13.</span> <span class="nav-text">JVM本地方法区里面都有什么？常量存在哪？字符串常量池？字符串中的常量什么时候进入常量池的？运行时常量池和字符串池是一回事吗？</span></a></li></ol></div>
            

          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">发现镓</span>
</div>

<div class="copyright">
  <span>HEXO-NEXT&nbsp; | &nbsp;粤ICP备14100221号</span>
  <span class="post-meta-divider">&nbsp; | &nbsp;</span>
  <span class="post-meta-item-icon">
    <i class="fa fa-area-chart"></i>
  </span>
  <span class="post-meta-item-text">站点总字数：</span>
  
  <span title="站点总字数">230k</span>
  <span class="post-meta-divider">&nbsp; | &nbsp;</span>
  <span class="post-meta-item-icon">
    <i class="fa fa-coffee"></i>
  </span>
    <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
  
  <span title="站点阅读时长">3:29</span>

</div>

<div class="copyright">
  

</div>

        

<div class="busuanzi-count">

  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  

</div>



        
      </div>
    </footer>
  </div>
  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/cdn/jquery.min.js"></script>

  
  <script type="text/javascript" src="/cdn/fastclick.min.js"></script>

  
  <script type="text/javascript" src="/cdn/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="/cdn/velocity.min.js"></script>

  
  <script type="text/javascript" src="/cdn/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="/cdn/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>


  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>


  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>


  



  




  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.loli.net/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


  

  
<script type="text/javascript" async src="//zz.bdstatic.com/linksubmit/push.js">
</script>


  

  
  
  
    
  
  <link rel="stylesheet" href="//cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>


  

  <script async src="/js/cursor/fireworks.js"></script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>


</body>
</html>
